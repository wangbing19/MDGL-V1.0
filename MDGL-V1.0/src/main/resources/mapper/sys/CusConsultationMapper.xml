<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 命名空间：映射文件所在目录.名称 -->
<mapper namespace="com.md.sys.dao.cus.CusConsultationDao">

	<!-- 基于用户名/电话的查询条件sql引用语句 -->
	<sql id="queryWhereId">
       <where>
			<!-- name条件 -->
			<if test="name!=null and name!=''">
				name like concat("%",#{name},"%")
			</if>
			<!-- tel条件 -->
			<if test="tel!=null and tel!=''">
				or name like concat("%",#{tel},"%")
			</if>
		</where>
	</sql>
	
	<!-- 基于用户姓名及分页条件查询,无用户名输入基于分页条件查询 -->
	<select id="findPageObjects" resultType="com.md.sys.entity.cus.CusConsultation">
		select id,name,tel,r_d rD,l_d lD,r_cva rCva,l_cva lCva,tutor,gmt_modified gmtModified
		from cus_consultation
        <include refid="queryWhereId"/>
		limit #{startIndex},#{pageSize}
	</select>
	
	<!-- 基于用户名查询该用户总数,无用户名输入查询所有用户总数 -->
	<select id="getRowCount" resultType="int">
		select count(*) from cus_consultation
		<include refid="queryWhereId"/>
	</select>
	
	<!-- 将CusCustomer类型数据添加到数据库 -->
	<insert id="insertObject">
		insert into cus_consultation
		(name,age,gender,tel,eye,decline_time,diagnose,oculopathy,correction_method,effect,visual_acuity,f_vision_condition,
		f_other,m_vision_condition,m_other,sleeping_time,eye_project,reading_time,reading_distance,watching_time,watching_distance,
		eye_position,home_lighting_environment,classroom_lighting_environment,r_d,l_d,r_cva,l_cva,tutor,
		gmt_create,gmt_modified,created_user,modified_user)
		values
		(#{name},#{age},#{gender},#{tel},#{eye},#{declineTime},#{diagnose},#{oculopathy},#{correctionMethod},#{effect},
		#{visualAcuity},#{fVisionCondition},#{fOther},#{mVisionCondition},#{mOther},#{sleepingTime},#{eyeProject},#{readingTime},
		#{readingDistance},#{watchingTime},#{watchingDistance},#{eyePosition},#{homeLightingEnvironment},
		#{classroomLightingEnvironment},#{rD},#{lD},#{rCva},#{lCva},#{tutor},now(),now(),#{createdUser},
		#{modifiedUser})
	</insert>
	
	<!-- 基于咨询表客户id删除咨询表信息 -->
	<delete id="deleteObject">
		delete from cus_consultation where id=#{id}
	</delete>
	
</mapper>